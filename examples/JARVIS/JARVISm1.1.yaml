flow:
  _target_: aiflows.ControllerExecutorFlowModule.ControllerExecutorFlow.instantiate_from_default_config
  max_rounds: 30
  python_file_path: examples/JARVIS/library.py #Relative path from where you're running
  ### Subflows specification
  subflows_config:
    Controller:
      _target_: baldwin.JarvisFlowModule.JarvisControllerFlow.instantiate_from_default_config
      sys_prompt_pyfile_input_variable_name: python_file
      python_file_path: ${flow.python_file_path}
      commands:
        run_python_code:
          description: "Call a python function which is written in a py file whose contents are in the Python File section"
          input_args: ["called_function", "kwargs"]
        finish:
          description: "Signal that the objective has been satisfied, and returns the answer to the user."
          input_args: ["answer"]

      input_interface_initialized:
        - "observation"

      human_message_prompt_template:
        _target_: flows.prompt_template.JinjaPrompt
        template: |2-
          Here is the response to your last action:
          {{observation}}
        input_variables:
          - "observation"

      backend:
        api_infos: ???
      output_interface:
        - "thought"
        - "reasoning"
        - "plan"
        - "criticism"
        - "speak"
        - "command"
        - "command_args"

      #######################################################
      # ToDo: Some parts of the prompt don't make sense -- update them
      system_message_prompt_template:
        template: |2-
          You are a smart AI assistant.

          Your decisions must always be made independently without seeking user assistance.
          Play to your strengths as an LLM and pursue simple strategies with no legal complications.
          If you have completed all your tasks, make sure to use the "finish" command.

          Constraints:
          1. ~4000 word limit for short term memory. Your short term memory is short, so immediately save important information to files
          2. If you are unsure how you previously did something or want to recall past events, thinking about similar events will help you remember
          3. No user assistance
          4. Exclusively use the python functions defined in available functions

          Available Functions:
          {{commands}}

          Python File:
          {{python_file}}

          Resources:
          1. A python file defined in Available functions for execution
          2. Long Term memory management.
          3. GPT powered Agents for delegation of simple tasks.

          Performance Evaluation:
          1. Continuously review and analyze your actions to ensure you are performing to the best of your abilities.
          2. Constructively self-criticize your big-picture behavior constantly.
          3. Reflect on past decisions and strategies to refine your approach.
          4. Every command has a cost, so be smart and efficient. Aim to complete tasks in the least number of steps.
          You should absolutely only respond in JSON format as described below
          Response Format:
          {
          "thought": "thought",
          "reasoning": "reasoning",
          "plan": "- short bulleted\n- list that conveys\n- long-term plan",
          "criticism": "constructive self-criticism",
          "speak": "thoughts summary to say to user",
          "command": "the python function you would like to call",
          "command_args": {
              "arg name": "value"
              }
          }
          Ensure your responses can be parsed by Python json.loads
        input_variables:
          [
            "commands",
            "${flow.subflows_config.Controller.sys_prompt_pyfile_input_variable_name}",
          ]

    Executor:
      _target_: flows.base_flows.BranchingFlow.instantiate_from_default_config
      subflows_config:
        run_python_code:
          _target_: baldwin.PyFileInterpreterFlowModule.PyFileInterpreterAtomicFlow.instantiate_from_default_config
          path_to_py_file: ${flow.python_file_path}

  topology:
    - goal: "Select the next action and prepare the input for the executor."
      input_interface:
        _target_: flows.interfaces.KeyInterface
        additional_transformations:
          - _target_: flows.data_transformations.KeyMatchInput
      flow: Controller
      output_interface:
        _target_: ControllerExecutorFlow.detect_finish_or_continue
      reset: false

    - goal: "Execute the action specified by the Controller."
      input_interface:
        _target_: flows.interfaces.KeyInterface
        keys_to_rename:
          command: branch
          command_args: branch_input_data
        keys_to_select: ["branch", "branch_input_data"]
      flow: Executor
      output_interface:
        _target_: flows.interfaces.KeyInterface
        keys_to_rename:
          branch_output_data: observation
        keys_to_select: ["observation"]
      reset: false
